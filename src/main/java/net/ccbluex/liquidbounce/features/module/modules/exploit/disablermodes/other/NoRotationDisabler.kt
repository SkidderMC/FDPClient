/*
 * FDPClient Hacked Client
 * A free open source mixin-based injection hacked client for Minecraft using Minecraft Forge by LiquidBounce.
 * https://github.com/SkidderMC/FDPClient/
 */
package net.ccbluex.liquidbounce.features.module.modules.exploit.disablermodes.other

import net.ccbluex.liquidbounce.event.PacketEvent
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.modifyModeValue
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.offsetAmountValue
import net.ccbluex.liquidbounce.features.module.modules.exploit.disablermodes.DisablerMode
import net.ccbluex.liquidbounce.utils.PacketUtils.sendPacket
import net.minecraft.network.play.client.C03PacketPlayer
import net.minecraft.network.play.client.C03PacketPlayer.*

/**
 * Doesn't work well with high ping
 *
 * @author Zywl
 */
object NoRotationDisabler : DisablerMode("NoRotationDisabler") {

    val valuePrefix = "$modeName-"

    override fun onPacket(event: PacketEvent) {
        val packet = event.packet
        if (packet is C03PacketPlayer) {
            when(modifyModeValue) {
                "ConvertNull" -> {
                    if(packet.isMoving) {
                        sendPacket(C04PacketPlayerPosition(packet.x, packet.y, packet.z, packet.onGround))
                    }else {
                        sendPacket(C03PacketPlayer(packet.onGround))
                    }
                    event.cancelEvent()
                }
                
                "Spoof" -> {
                    if(packet.getRotating()) {
                        packet.yaw = mc.thePlayer.rotationYaw
                        packet.pitch = mc.thePlayer.rotationPitch
                    }
                }
                
                "Zero" -> {
                    if(packet.getRotating()) {
                        packet.yaw = 0.0f
                        packet.pitch = 0.0f
                    }
                }
                
                "SpoofZero" -> {
                    if(packet.isMoving) {
                        sendPacket(C06PacketPlayerPosLook(packet.x, packet.y, packet.z, 0.0f, 0.0f, packet.onGround))
                    }else {
                        sendPacket(C06PacketPlayerPosLook(mc.thePlayer.posX, mc.thePlayer.posY, mc.thePlayer.posZ, 0.0f, 0.0f, packet.onGround))
                    }
                    event.cancelEvent()
                }
                
                "Negative" -> {
                    if(packet.getRotating()) {
                        packet.yaw = -packet.yaw
                        packet.pitch = -packet.pitch
                    }
                }
                
                "OffsetYaw" -> {
                    if(packet.getRotating()) {
                        packet.yaw += offsetAmountValue
                    }
                }
            }
        }
    }
}