package net.ccbluex.liquidbounce.features.module.modules.exploit.disablers.spectate

import me.zywl.fdpclient.event.PacketEvent
import net.ccbluex.liquidbounce.features.module.modules.exploit.disablers.DisablerMode
import net.ccbluex.liquidbounce.value.BoolValue
import net.minecraft.network.play.client.C03PacketPlayer
import net.minecraft.network.play.client.C18PacketSpectate
import net.minecraft.network.play.client.C13PacketPlayerAbilities

class SpectateDisabler : DisablerMode("Spectate") {

    private val modifyC13 = BoolValue("ModifyAbilities", true)
    private val sendC13 = BoolValue("SpamAbilities", false)

    override fun onPacket(event: PacketEvent) {
        val packet = event.packet
        if (packet is C03PacketPlayer) {
            mc.netHandler.addToSendQueue(C18PacketSpectate(mc.thePlayer.uniqueID))
            if (sendC13.get()) {
                mc.netHandler.addToSendQueue(C13PacketPlayerAbilities(mc.thePlayer.capabilities))
                disabler.debugMessage("Packet C13")
            }
            disabler.debugMessage("Packet C18")
        }

        if (packet is C13PacketPlayerAbilities && modifyC13.get()) {
            disabler.debugMessage("Modify C13")
            packet.isFlying = true
            packet.isInvulnerable = true
            packet.isAllowFlying = true
            packet.isCreativeMode = false
        }
    }
}